<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <link href="https://fonts.maateen.me/kalpurush/font.css" rel="stylesheet">
    <style>
        :root {
            --forest-green: #228B22;
            --forest-green-dark: #1a6b1a;
            --forest-green-light: #2da52d;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --dark-gray: #333333;
            --border-radius: 12px;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --gradient: linear-gradient(135deg, #228B22 0%, #32CD32 100%);
            --royal-blue: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--white);
            color: var(--dark-gray);
            line-height: 1.7;
            min-height: 100vh;
            font-family: 'Kalpurush', 'Times New Roman', serif;
        }

        .english-text {
            font-family: 'Times New Roman', serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 5px 0;
            margin-bottom: 15px;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 10px;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 200%;
            height: 200%;
            max-width: 180px;
            max-height: 180px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
        }

        
        .admin-access {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            background: var(--gradient);
            color: var(--white);
            font-family: 'Kalpurush', 'Times New Roman', serif;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(34, 139, 34, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(34, 139, 34, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 25px;
            border-left: 5px solid var(--forest-green);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--forest-green);
            font-size: 18px;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Kalpurush', 'Times New Roman', serif;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--forest-green);
            box-shadow: 0 0 0 3px rgba(34, 139, 34, 0.1);
        }

        /* FIXED: Auto-expanding textarea */
        textarea {
            min-height: 150px;
            resize: none;
            overflow: hidden;
            transition: height 0.2s ease;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light-gray);
        }

        .upload-area:hover {
            border-color: var(--forest-green);
            background-color: rgba(34, 139, 34, 0.05);
            transform: scale(1.02);
        }

        .upload-area i {
            font-size: 48px;
            color: var(--forest-green);
            margin-bottom: 15px;
        }

        .lesson-image {
            max-width: 100%;
            max-height: 300px;
            margin-bottom: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .confirmation-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 1001;
            border: 3px solid var(--forest-green);
            animation: popIn 0.5s ease-out;
        }

        .warning-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 1001;
            border: 3px solid #dc3545;
            animation: popIn 0.5s ease-out;
        }

        .error-message-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 1001;
            border: 3px solid #ffc107;
            animation: popIn 0.5s ease-out;
        }

        .error-message-popup .warning-icon {
            font-size: 60px;
            color: #ffc107;
            margin-bottom: 20px;
        }

        .warning-message .warning-icon {
            font-size: 60px;
            color: #dc3545;
            margin-bottom: 20px;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .confirmation-message .tick {
            font-size: 60px;
            color: var(--forest-green);
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        .confirmation-message h3 {
            margin-bottom: 20px;
            color: var(--forest-green);
            font-size: 24px;
        }

        .warning-message h3 {
            margin-bottom: 20px;
            color: #dc3545;
            font-size: 24px;
        }

        .error-message-popup h3 {
            margin-bottom: 20px;
            color: #856404;
            font-size: 24px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .filter-panel {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 25px;
            background: linear-gradient(to right, #f8fff8, #ffffff);
            border: 1px solid #e8f5e8;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .lesson-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .lesson-card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            transition: all 0.3s ease;
            border-top: 4px solid var(--forest-green);
            position: relative;
            overflow: hidden;
        }

        .lesson-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient);
        }

        .lesson-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .lesson-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 12px;
            color: var(--forest-green);
        }

        .lesson-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        /* FIXED: Text wrapping for displayed lesson content */
        .lesson-content {
            margin-bottom: 20px;
            line-height: 1.8;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            word-break: break-word;
            max-width: 100%;
            overflow: hidden;
        }

        .lesson-image-preview {
            max-width: 100%;
            border-radius: var(--border-radius);
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-danger {
            background: linear-gradient(to bottom, #dc3545, #c82333);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(to bottom, #e04b59, #d92535);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .admin-login-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 35px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            width: 90%;
            max-width: 450px;
            animation: popIn 0.4s ease-out;
        }

        .admin-login-form h3 {
            margin-bottom: 25px;
            color: var(--forest-green);
            text-align: center;
            font-size: 22px;
        }

        .admin-login-form .form-group {
            margin-bottom: 20px;
        }

        .admin-login-form .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--forest-green);
            font-size: 18px;
        }

        .no-lesson-message {
            color: #666;
            text-align: center;
            padding: 30px;
            font-size: 16px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border: 2px solid #e9ecef;
        }

        .recent-lesson-badge {
            background: var(--gradient);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            position: absolute;
            top: 15px;
            right: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 139, 34, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 139, 34, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 139, 34, 0); }
        }

        .section-title {
            font-size: 28px;
            color: var(--forest-green);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .lesson-list {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
            }

            .admin-actions {
                flex-direction: column;
            }
            
            .card {
                padding: 20px;
            }
            
            .academy-name {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo">
                        <img src="logo.png" alt="Logo">
                    </div>
                    
                </div>
                <div class="admin-access">
                    <button id="adminBtn" class="btn">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Lesson Plan Submission Form -->
        <div id="lessonForm" class="card">
            <h2 class="section-title">‡¶≤‡ßá‡¶∏‡¶® ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡¶´‡¶ü‡¶ì‡ßü‡ßç‡¶Ø‡¶æ‡¶∞</h2>
            <div class="form-group">
                <label for="userName">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                <input type="text" id="userName" placeholder="‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>
            <div class="form-group">
                <label for="classSelect">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</label>
                <select id="classSelect">
                    <option value="">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="subjectSelect">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º</label>
                <select id="subjectSelect">
                    <option value="">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <!-- Options will be populated dynamically based on class selection -->
                </select>
            </div>
            <div class="form-group">
                <label for="lessonNo">‡¶≤‡ßá‡¶∏‡¶® ‡¶®‡¶Ç</label>
                <select id="lessonNo">
                    <option value="">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label>‡¶≤‡ßá‡¶∏‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü</label>
                <textarea id="lessonText" placeholder="‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
            </div>
            <div class="form-group">
                <label>‡¶Ö‡¶•‡¶¨‡¶æ ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <div class="upload-area" id="uploadArea">
                    <i>üìÅ</i>
                    <p>‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶ó ‡¶è‡¶®‡ßç‡¶° ‡¶°‡ßç‡¶∞‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <p>PNG, JPG, GIF - ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ßß‡ß´MB</p>
                </div>
                <input type="file" id="lessonImage" accept="image/*" style="display: none;">
                <img id="imagePreview" class="lesson-image hidden" src="" alt="Preview">
            </div>
            <button id="submitLessonBtn" class="btn">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <!-- Filter Panel -->
        <div class="filter-panel">
            <h2 class="section-title">‡¶≤‡ßá‡¶∏‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="filterClass">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</label>
                    <select id="filterClass">
                        <option value="">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterSubject">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º</label>
                    <select id="filterSubject">
                        <option value="">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <!-- Options will be populated dynamically based on class selection -->
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterLessonNo">‡¶≤‡ßá‡¶∏‡¶® ‡¶®‡¶Ç</label>
                    <select id="filterLessonNo">
                        <option value="">‡¶≤‡ßá‡¶∏‡¶® ‡¶®‡¶Ç ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
            </div>
            <button id="applyFilterBtn" class="btn">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading hidden">
            <p>‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>

        <!-- Lesson Plans List -->
        <div id="lessonsList" class="lesson-list">
            <div class="no-lesson-message">
                ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            </div>
        </div>
    </div>

    <!-- Confirmation Message -->
    <div id="confirmationMessage" class="confirmation-message hidden">
        <div class="tick">‚úì</div>
        <h3 id="confirmationTitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßá‡¶∏‡¶® ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá</h3>
        <p id="confirmationText">‡¶ú‡¶æ‡¶ù‡¶æ‡¶ï‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡ßÅ ‡¶ñ‡¶æ‡¶á‡¶∞‡¶®</p>
        <button id="confirmationOkBtn" class="btn">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
    </div>

    <!-- Warning Message -->
    <div id="warningMessage" class="warning-message hidden">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3 id="warningTitle">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h3>
        <p id="warningText">‡¶â‡¶ï‡ßç‡¶§ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø‡¶∞ ‡¶≤‡ßá‡¶∏‡¶® ‡¶è‡¶ñ‡¶®‡ßã ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</p>
        <button id="warningOkBtn" class="btn">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
    </div>

    <!-- Error Message Popup -->
    <div id="errorMessagePopup" class="error-message-popup hidden">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3 id="errorPopupTitle">‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø</h3>
        <p id="errorPopupText"></p>
        <button id="errorPopupOkBtn" class="btn">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
    </div>

    <!-- Admin Login Form -->
    <div id="adminLoginForm" class="admin-login-form hidden">
        <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
        <div class="form-group">
            <label for="adminPassword">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
            <input type="password" id="adminPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®">
        </div>
        <div class="actions">
            <button id="cancelAdminLogin" class="btn btn-danger">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
            <button id="submitAdminLogin" class="btn">‡¶≤‡¶ó‡¶á‡¶®</button>
        </div>
    </div>

    <div id="overlay" class="overlay hidden"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDzaLns7aRUMB_RjnS6iUKyxwHXfRqmxwg",
            authDomain: "mcq-exam-generator-e10c7.firebaseapp.com",
            databaseURL: "https://mcq-exam-generator-e10c7-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mcq-exam-generator-e10c7",
            storageBucket: "mcq-exam-generator-e10c7.firebasestorage.app",
            messagingSenderId: "51613317429",
            appId: "1:51613317429:web:3e92cc83224d18e320747c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Firebase Database operations
        const Database = {
            async addLesson(lessonData) {
                const lessonId = 'lesson_' + Date.now();
                await database.ref('lessons/' + lessonId).set({
                    ...lessonData,
                    id: lessonId,
                    timestamp: Date.now()
                });
                return lessonId;
            },

            async getLessons() {
                try {
                    const snapshot = await database.ref('lessons').once('value');
                    return snapshot.val() || {};
                } catch (error) {
                    console.error('Error fetching lessons:', error);
                    throw error;
                }
            },

            async deleteLesson(lessonId) {
                await database.ref('lessons/' + lessonId).remove();
            },

            async deleteLessonsByClass(classId) {
                const snapshot = await database.ref('lessons').once('value');
                const lessons = snapshot.val() || {};
                
                const deletePromises = [];
                Object.keys(lessons).forEach(lessonId => {
                    if (lessons[lessonId].classId === classId) {
                        deletePromises.push(this.deleteLesson(lessonId));
                    }
                });
                
                await Promise.all(deletePromises);
            },

            // Listen for real-time updates
            onLessonsUpdate(callback) {
                database.ref('lessons').on('value', (snapshot) => {
                    callback(snapshot.val() || {});
                });
            },

            offLessonsUpdate() {
                database.ref('lessons').off();
            }
        };

        // Configuration - Easy to modify
        const CONFIG = {
            adminPassword: "admin123", // Change this password as needed
            classes: [
                { id: "class1", name: "‡¶™‡ßç‡¶≤‡ßá", subjects: ["‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® ‡¶Æ‡¶æ‡¶ú‡ßÄ‡¶¶", "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ", "English", "‡¶ó‡¶£‡¶ø‡¶§"] },
                { id: "class2", name: "‡¶®‡¶æ‡¶∞‡ßç‡¶∏‡¶æ‡¶∞‡¶ø", subjects: ["‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® ‡¶Æ‡¶æ‡¶ú‡ßÄ‡¶¶", "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§-‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ú‡ßç‡¶û‡¶æ‡¶®", "English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï-‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú"] },
                { id: "class3", name: "‡¶™‡ßç‡¶∞‡¶•‡¶Æ", subjects: ["‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® ‡¶Æ‡¶æ‡¶ú‡ßÄ‡¶¶", "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï-‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ú‡ßç‡¶û‡¶æ‡¶®", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú"] },
                { id: "class4", name: "‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ú‡ßç‡¶û‡¶æ‡¶®-‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ (‡¶ï)", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ (‡¶ñ)", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú"] },
                { id: "class5", name: "‡¶§‡ßÉ‡¶§‡ßÄ‡ßü", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®-‡¶¨‡¶æ‡¶ì‡¶¨‡¶ø-‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú", "‡¶ï‡¶æ‡ßü‡¶¶a", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶¨‡¶ø‡¶ó‡¶ø‡¶®‡¶æ‡¶∞‡ßç‡¶∏", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶ì ‡¶π‡¶ø‡¶´‡¶ú", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ï)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ñ)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ó)"] },
                { id: "class6", name: "‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶•", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®-‡¶¨‡¶æ‡¶ì‡¶¨‡¶ø-‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶¨‡¶ø‡¶ó‡¶ø‡¶®‡¶æ‡¶∞‡ßç‡¶∏", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶ì ‡¶π‡¶ø‡¶´‡¶ú", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ï)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ñ)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ó)"] },
                { id: "class7", name: "‡¶™‡¶û‡ßç‡¶ö‡¶Æ", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®-‡¶¨‡¶æ‡¶ì‡¶¨‡¶ø-‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶¨‡¶ø‡¶ó‡¶ø‡¶®‡¶æ‡¶∞‡ßç‡¶∏", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶ì ‡¶π‡¶ø‡¶´‡¶ú", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ï)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ñ)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ó)"] },
                { id: "class8", name: "‡¶∑‡¶∑‡ßç‡¶†", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£", "English", "English Grammar-Spoken English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®", "‡¶¨‡¶æ‡¶ì‡¶¨‡¶ø-ICT-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶¨‡¶ø‡¶ó‡¶ø‡¶®‡¶æ‡¶∞‡ßç‡¶∏", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶ì ‡¶π‡¶ø‡¶´‡¶ú", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ï)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ñ)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ó)"] },
                { id: "class9", name: "‡¶∏‡¶™‡ßç‡¶§‡¶Æ", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£", "English", "English Grammar-Spoken English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®", "‡¶¨‡¶æ‡¶ì‡¶¨‡¶ø-ICT-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶¨‡¶ø‡¶ó‡¶ø‡¶®ÿßÿ±‡ßç‡¶∏", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶ì ‡¶π‡¶ø‡¶´‡¶ú", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ï)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ñ)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ó)"] },
                { id: "class10", name: "‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ", subjects: ["‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ-‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£", "English", "English Grammar-Spoken English", "‡¶ó‡¶£‡¶ø‡¶§", "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®", "‡¶¨‡¶æ‡¶ì‡¶¨‡¶ø-ICT-‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§", "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø‡¶ú", "‡¶ï‡¶æ‡ßü‡¶¶‡¶æ", "‡¶Ü‡¶Æ‡¶™‡¶æ‡¶∞‡¶æ", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶¨‡¶ø‡¶ó‡¶ø‡¶®‡¶æ‡¶∞‡ßç‡¶∏", "‡¶®‡¶æ‡¶ú‡ßá‡¶∞‡¶æ ‡¶ì ‡¶π‡¶ø‡¶´‡¶ú", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ï)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ñ)", "‡¶∏‡ßç‡¶™‡ßã‡¶ï‡ßá‡¶® ‡¶è‡¶∞‡¶æ‡¶¨‡¶ø‡¶ï (‡¶ó)"] }
            ],
            lessonNumbers: 12 // Number of lessons (1 to 12)
        };

        // DOM Elements
        const lessonForm = document.getElementById('lessonForm');
        const userName = document.getElementById('userName');
        const lessonNo = document.getElementById('lessonNo');
        const classSelect = document.getElementById('classSelect');
        const subjectSelect = document.getElementById('subjectSelect');
        const lessonText = document.getElementById('lessonText');
        const uploadArea = document.getElementById('uploadArea');
        const lessonImage = document.getElementById('lessonImage');
        const imagePreview = document.getElementById('imagePreview');
        const submitLessonBtn = document.getElementById('submitLessonBtn');
        const filterLessonNo = document.getElementById('filterLessonNo');
        const filterClass = document.getElementById('filterClass');
        const filterSubject = document.getElementById('filterSubject');
        const applyFilterBtn = document.getElementById('applyFilterBtn');
        const lessonsList = document.getElementById('lessonsList');
        const loadingState = document.getElementById('loadingState');
        const adminBtn = document.getElementById('adminBtn');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const adminPassword = document.getElementById('adminPassword');
        const cancelAdminLogin = document.getElementById('cancelAdminLogin');
        const submitAdminLogin = document.getElementById('submitAdminLogin');
        const confirmationMessage = document.getElementById('confirmationMessage');
        const confirmationTitle = document.getElementById('confirmationTitle');
        const confirmationText = document.getElementById('confirmationText');
        const confirmationOkBtn = document.getElementById('confirmationOkBtn');
        const warningMessage = document.getElementById('warningMessage');
        const warningTitle = document.getElementById('warningTitle');
        const warningText = document.getElementById('warningText');
        const warningOkBtn = document.getElementById('warningOkBtn');
        const errorMessagePopup = document.getElementById('errorMessagePopup');
        const errorPopupTitle = document.getElementById('errorPopupTitle');
        const errorPopupText = document.getElementById('errorPopupText');
        const errorPopupOkBtn = document.getElementById('errorPopupOkBtn');
        const overlay = document.getElementById('overlay');

        // State variables
        let isAdmin = false;
        let lessons = {};
        let currentImageData = null;
        let unsubscribeFromLessons = null;
        let currentUserName = '';

        // Initialize the application
        function init() {
            populateLessonNumbers();
            populateClasses();
            setupEventListeners();
            loadLessons();
            
            // Set up real-time updates
            unsubscribeFromLessons = Database.onLessonsUpdate((updatedLessons) => {
                lessons = updatedLessons;
                // Don't automatically display lessons after submission
            });
        }

        // Populate lesson number dropdowns
        function populateLessonNumbers() {
            for (let i = 1; i <= CONFIG.lessonNumbers; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `‡¶≤‡ßá‡¶∏‡¶® ${i}`;
                lessonNo.appendChild(option);
                
                const filterOption = option.cloneNode(true);
                filterLessonNo.appendChild(filterOption);
            }
        }

        // Populate class dropdowns
        function populateClasses() {
            CONFIG.classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls.id;
                option.textContent = cls.name;
                classSelect.appendChild(option);
                
                const filterOption = option.cloneNode(true);
                filterClass.appendChild(filterOption);
            });
        }

        // Update subjects based on selected class
        function updateSubjects(classId, subjectSelectElement) {
            // Clear existing options except the first one
            while (subjectSelectElement.children.length > 1) {
                subjectSelectElement.removeChild(subjectSelectElement.lastChild);
            }
            
            if (classId) {
                const selectedClass = CONFIG.classes.find(cls => cls.id === classId);
                if (selectedClass) {
                    selectedClass.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        subjectSelectElement.appendChild(option);
                    });
                }
            }
        }

        // Auto-resize textarea function
        function autoResizeTextarea(textarea) {
            // Reset height to auto to get the correct scrollHeight
            textarea.style.height = 'auto';
            // Set the height to scrollHeight to fit all content
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Class selection change
            classSelect.addEventListener('change', function() {
                updateSubjects(this.value, subjectSelect);
            });
            
            filterClass.addEventListener('change', function() {
                updateSubjects(this.value, filterSubject);
            });
            
            // Upload area click
            uploadArea.addEventListener('click', function() {
                lessonImage.click();
            });
            
            // File input change
            lessonImage.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Check file size (15MB limit)
                    if (file.size > 15 * 1024 * 1024) {
                        showErrorPopup('‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ ‡ßß‡ß´MB ‡¶è‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        currentImageData = e.target.result;
                        imagePreview.src = currentImageData;
                        imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Auto-resize textarea on input
            lessonText.addEventListener('input', function() {
                autoResizeTextarea(this);
            });
            
            // Initialize textarea height
            autoResizeTextarea(lessonText);
            
            // Submit lesson
            submitLessonBtn.addEventListener('click', submitLesson);
            
            // Apply filters
            applyFilterBtn.addEventListener('click', applyFilters);
            
            // Admin button
            adminBtn.addEventListener('click', showAdminLogin);
            
            // Admin login
            cancelAdminLogin.addEventListener('click', hideAdminLogin);
            submitAdminLogin.addEventListener('click', handleAdminLogin);
            
            // Confirmation
            confirmationOkBtn.addEventListener('click', hideConfirmation);
            
            // Warning
            warningOkBtn.addEventListener('click', hideWarning);
            
            // Error popup
            errorPopupOkBtn.addEventListener('click', hideErrorPopup);
        }

        // Load lessons from Firebase
        async function loadLessons() {
            try {
                showLoading();
                lessons = await Database.getLessons();
                hideLoading();
            } catch (error) {
                showErrorPopup('‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                hideLoading();
            }
        }

        // Submit lesson plan
        async function submitLesson() {
            const name = userName.value.trim();
            const lessonNumber = lessonNo.value;
            const classId = classSelect.value;
            const subject = subjectSelect.value;
            const text = lessonText.value.trim();
            
            if (!name || !lessonNumber || !classId || !subject || (!text && !currentImageData)) {
                showErrorPopup('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶π‡¶Ø‡¶º ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            try {
                submitLessonBtn.disabled = true;
                submitLessonBtn.textContent = '‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                
                currentUserName = name;
                
                const lesson = {
                    userName: name,
                    lessonNumber: parseInt(lessonNumber),
                    classId: classId,
                    className: CONFIG.classes.find(cls => cls.id === classId).name,
                    subject: subject,
                    text: text,
                    imageData: currentImageData,
                    timestamp: Date.now()
                };
                
                await Database.addLesson(lesson);
                
                // Reset form
                userName.value = '';
                lessonNo.value = '';
                classSelect.value = '';
                subjectSelect.value = '';
                lessonText.value = '';
                lessonImage.value = '';
                imagePreview.classList.add('hidden');
                currentImageData = null;
                
                // Reset textarea height
                autoResizeTextarea(lessonText);
                
                // Update subjects dropdown
                updateSubjects('', subjectSelect);
                
                // Show confirmation
                showConfirmation('‡¶≤‡ßá‡¶∏‡¶® ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá', '‡¶ú‡¶æ‡¶ù‡¶æ‡¶ï‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡ßÅ ‡¶ñ‡¶æ‡¶á‡¶∞‡¶®');
                
            } catch (error) {
                showErrorPopup('‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            } finally {
                submitLessonBtn.disabled = false;
                submitLessonBtn.textContent = '‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
            }
        }

        // Apply filters
        function applyFilters() {
            const filterClassId = filterClass.value;
            const filterSubjectValue = filterSubject.value;
            const filterLessonNumber = filterLessonNo.value;
            
            // Check if at least class is selected
            if (!filterClassId) {
                showErrorPopup('‡¶≤‡ßá‡¶∏‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            // Apply filters
            let filteredLessons = Object.values(lessons);
            
            // Filter by class
            filteredLessons = filteredLessons.filter(lesson => 
                lesson.classId === filterClassId
            );
            
            // Filter by subject if selected
            if (filterSubjectValue) {
                filteredLessons = filteredLessons.filter(lesson => 
                    lesson.subject === filterSubjectValue
                );
            }
            
            // Filter by lesson number if selected
            if (filterLessonNumber) {
                filteredLessons = filteredLessons.filter(lesson => 
                    lesson.lessonNumber === parseInt(filterLessonNumber)
                );
            }
            
            // Sort by timestamp (newest first)
            filteredLessons.sort((a, b) => b.timestamp - a.timestamp);
            
            // Display results
            if (filteredLessons.length === 0) {
                showWarning('‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', '‡¶â‡¶ï‡ßç‡¶§ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø‡¶∞ ‡¶≤‡ßá‡¶∏‡¶® ‡¶è‡¶ñ‡¶®‡ßã ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§');
                lessonsList.innerHTML = '';
            } else {
                displayFilteredLessons(filteredLessons);
            }
        }

        // Display filtered lessons
        function displayFilteredLessons(filteredLessons) {
            lessonsList.innerHTML = '';
            
            filteredLessons.forEach(lesson => {
                const lessonCard = createLessonCard(lesson);
                lessonsList.appendChild(lessonCard);
            });
        }

        // Create lesson card element
        function createLessonCard(lesson) {
            const lessonCard = document.createElement('div');
            lessonCard.className = 'lesson-card';
            
            let contentHTML = '';
            if (lesson.text) {
                contentHTML = `<div class="lesson-content">${lesson.text}</div>`;
            }
            
            if (lesson.imageData) {
                contentHTML += `<img src="${lesson.imageData}" alt="Lesson plan image" class="lesson-image-preview">`;
            }
            
            lessonCard.innerHTML = `
                <div class="lesson-title">‡¶≤‡ßá‡¶∏‡¶® ${lesson.lessonNumber} - ${lesson.subject}</div>
                <div class="lesson-meta">
                    <strong>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏:</strong> ${lesson.className} | 
                    <strong>‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®:</strong> ${lesson.userName} | 
                    <strong>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${new Date(lesson.timestamp).toLocaleDateString('bn-BD')}
                </div>
                ${contentHTML}
                ${isAdmin ? `
                    <div class="admin-actions">
                        <button class="btn btn-danger delete-lesson-btn" data-lesson-id="${lesson.id}">‡¶è‡¶á ‡¶≤‡ßá‡¶∏‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button class="btn btn-danger delete-class-lessons-btn" data-class-id="${lesson.classId}">‡¶∏‡¶¨ ${lesson.className} ‡¶≤‡ßá‡¶∏‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                ` : ''}
            `;
            
            // Add event listeners for admin buttons if admin is logged in
            if (isAdmin) {
                const deleteBtn = lessonCard.querySelector('.delete-lesson-btn');
                const deleteClassBtn = lessonCard.querySelector('.delete-class-lessons-btn');
                
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        const lessonId = this.getAttribute('data-lesson-id');
                        deleteLesson(lessonId);
                    });
                }
                
                if (deleteClassBtn) {
                    deleteClassBtn.addEventListener('click', function() {
                        const classId = this.getAttribute('data-class-id');
                        const className = CONFIG.classes.find(cls => cls.id === classId).name;
                        deleteClassLessons(classId, className);
                    });
                }
            }
            
            return lessonCard;
        }

        // Delete a specific lesson
        async function deleteLesson(lessonId) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ö‡¶æ‡¶®?')) {
                try {
                    await Database.deleteLesson(lessonId);
                    showConfirmation('‡¶≤‡ßá‡¶∏‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', '‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                    // Refresh the current filter view
                    applyFilters();
                } catch (error) {
                    showErrorPopup('‡¶≤‡ßá‡¶∏‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                }
            }
        }

        // Delete all lessons for a specific class
        async function deleteClassLessons(classId, className) {
            if (confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ${className} ‡¶è‡¶∞ ‡¶∏‡¶¨ ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§`)) {
                try {
                    await Database.deleteLessonsByClass(classId);
                    showConfirmation('‡¶≤‡ßá‡¶∏‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', `${className} ‡¶è‡¶∞ ‡¶∏‡¶¨ ‡¶≤‡ßá‡¶∏‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);
                    // Refresh the current filter view
                    applyFilters();
                } catch (error) {
                    showErrorPopup('‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶≤‡ßá‡¶∏‡¶® ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                }
            }
        }

        // Admin login
        function showAdminLogin() {
            adminLoginForm.classList.remove('hidden');
            overlay.classList.remove('hidden');
        }

        function hideAdminLogin() {
            adminLoginForm.classList.add('hidden');
            overlay.classList.add('hidden');
            adminPassword.value = '';
        }

        function handleAdminLogin() {
            if (adminPassword.value === CONFIG.adminPassword) {
                isAdmin = true;
                hideAdminLogin();
                showConfirmation('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ñ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡¶æ‡¶∏‡¶®‡¶ø‡¶ï ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            } else {
                showErrorPopup('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            }
        }

        // Confirmation message
        function showConfirmation(title, text) {
            confirmationTitle.textContent = title;
            confirmationText.textContent = text;
            confirmationMessage.classList.remove('hidden');
            overlay.classList.remove('hidden');
        }

        function hideConfirmation() {
            confirmationMessage.classList.add('hidden');
            overlay.classList.add('hidden');
        }

        // Warning message
        function showWarning(title, text) {
            warningTitle.textContent = title;
            warningText.textContent = text;
            warningMessage.classList.remove('hidden');
            overlay.classList.remove('hidden');
        }

        function hideWarning() {
            warningMessage.classList.add('hidden');
            overlay.classList.add('hidden');
        }

        // Error popup message
        function showErrorPopup(message) {
            errorPopupTitle.textContent = '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø';
            errorPopupText.textContent = message;
            errorMessagePopup.classList.remove('hidden');
            overlay.classList.remove('hidden');
        }

        function hideErrorPopup() {
            errorMessagePopup.classList.add('hidden');
            overlay.classList.add('hidden');
        }

        // Loading state
        function showLoading() {
            loadingState.classList.remove('hidden');
            lessonsList.classList.add('hidden');
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
            lessonsList.classList.remove('hidden');
        }

        // Clean up when leaving the page
        window.addEventListener('beforeunload', () => {
            if (unsubscribeFromLessons) {
                unsubscribeFromLessons();
            }
        });

        // Initialize the application
        init();
    </script>
</body>
</html>
